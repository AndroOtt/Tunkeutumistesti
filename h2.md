Lokaatio: Kotona, Tietokone: Lenovo Thinkpad, mihin on kytketty thinkpad dockkeri.29.08. 01.09.2025 11:00 – 14:00

-	Exploits komento consolissa yksilöi koodin jota voidaan käyttää haavoittuvuuden  tunkeutumisessa
-	Payload tulee menestykkään exploitin jälkeen, payload määrittää mitä sen koodin pitää tehdä systeemissä.
-	Auxiliary tämä tarjoo lisää funktionaalisuuksia, kuten skannaamista, random datan syöttämistä (fuzzing), pääsy paketeille mitkä kulkevat verkon yli (sniffing).
-	Encoderid peittävät moduuleja että antivirukset tai palomuurit eivät pystyisi tunnistamaan haitallista koodia. 
-	Meterpreter on payloadi mikä käyttää DLL injektiota, jolloin voidaan tehdä erilaisia funktioita. 
Kappale seuraavaksi käsittää komentoja, miten niitä käytetään ja mitä ne tekee. 
Metasploit:in hyvät puolet ovat: Se perustuu avoimeen lähdekoodiin ja sitä päivitetään aktiivisesti. Paras puoli on kuitenkin se että se on ilmainen. Koska metasploit perustuu avoimeen lähdekoodiin, niin se antaa käyttäjille mahdollisuuden muokata ja lisätä omia räätälöityjä moduuleja. 
Metasploitillä on helppo tehdä automatisoituja massatestejä, kuten skannaa verkostoa missä on 200 eri systeemiä. 
-	Metasploitablen tietokannan käyttäminen ja hyödyntäminen, workspacet ja niitten toimivuus. 
Portskannausen perusteet, miten porttiskannauksella löydetään hyökkättävän kohteen OS ja mitä haavoittuvuutta voidaan kohdistaa siihen. 
Moduulien luokittelu, mitkä moduulit sopivat parhaiten haavoittuvuuden hyväksikäyttämiseen. 
Systeemiin pääsy exploittia käyttäämällä, tässä tapauksessa exploitti oli externalblue, melko kuuluisa exploitti mikä oli kehitetty Jenkeissä.
Eternalbluen käyttäminen ja mitä se tuottaa konsolissa. Lopulta päästiin windows serveriin, sen AD tietokantaan ja dumpattiin kaikki salasanojen hashit. Muutaman lisäpluginin lataamisen jälkeen, oli mahdollista nähdä salasanat clear tekstinä consolin outputissa.
a)	Koneiden välissä on host only network ja kali eikä metasploitable saa nettiyhteyttä. 
b)	Metasploitin console 
 <img width="602" height="492" alt="image" src="https://github.com/user-attachments/assets/7f33cf4a-8934-42ad-9c9f-01515e616d72" />


c)	db_nmap -sn ei tuottanut tulosta, koska tietokanta ei ole yhdistettyä vielä tässä vaiheessa. Joten päätin luoda postsql tietokannan.
 <img width="602" height="409" alt="image" src="https://github.com/user-attachments/assets/6780ff6f-d414-4b88-b934-64936ad98f2c" />

Sain yhteyden tietokantaan.
 <img width="602" height="465" alt="image" src="https://github.com/user-attachments/assets/efdf46e8-6d6c-4ff7-b854-644a5b3b880e" />

Nyt näytti että postgresql selected, mutta no connection, joten jos yritin db_nmap -sn niin ei mitään tapahtunut koska database ei ollu connected. Tässä vaiheessa yritin käynnistää uudelleen tietokannan ja sain yhdistetty.  
Db_nmap -sn ei tuottanut mitään tuloksia,
 <img width="602" height="485" alt="image" src="https://github.com/user-attachments/assets/3f9f7dd0-768d-4839-a2d8-33544ceeb555" />
<img width="602" height="481" alt="image" src="https://github.com/user-attachments/assets/a01d12bf-d6d9-4952-9aaa-3d687e551601" />

Joten kokeilin db_nmap -sn 192.158.56.0/24. Tämä komento ping sweeppaa 192.158.56.0-254 eri ip:tä. (ping sweep tarkoittaa sitä, että minun ip osoite lähettää discovery pakettejä eri ip osoitteille, mitä määritin komentorivillä, 192.158.56.0/24, eli 192.158.56.1, 192.158.56.2... jne kunnes 192.158.56.254. pakettimuotoja on ICMP ping, TCP SYN ja ARP request). 
Kokeilin lopulta db_nmap -sn 192.168.56.102, siinä näkyi paljon avonnaisia portteja, siitä päätellen se on metasploit 2.  
Syötin vielä ip osoitteen web-selaimeen.
<img width="602" height="491" alt="image" src="https://github.com/user-attachments/assets/4bcfa347-844d-484a-a970-421b9f861ca0" />


Metasploitable 2 on löydetty.
d)	Skannasin kaikki portit komennolla db_nmap -sS -p- 192.168.56.101
 <img width="602" height="746" alt="image" src="https://github.com/user-attachments/assets/e05571ea-da1f-4278-b8b6-fdbb6658aa6c" />

-sS tarkoittaa SYN Stealth Scannnia, se käytännössä lähettää TCP paketteja portreihin. Valitsin -sS turvallisuuden perusteella, sitä on vaikeampi havaita kun perus -sT skannia.
-p tarkoittaa kaikkija portteja, sen sijaan että nmap ottaisi defaulttina top 1000 käytetyintä porttia. 

e)	 
Hosts komento tuotti listan ip osoitteista mitkä aikasempi skanni oli löytänyt.
Services taas tuotti listan hostin porteista
 <img width="602" height="738" alt="image" src="https://github.com/user-attachments/assets/8cabc3d0-fd28-4f85-bd45-f443204e0f07" />
 <img width="602" height="739" alt="image" src="https://github.com/user-attachments/assets/caa0aa3d-3829-4baf-8fc8-3b2f59993af2" />



Services -p 21 sain suodatettu services tuloksia 
 <img width="602" height="177" alt="image" src="https://github.com/user-attachments/assets/c08e33c7-bcec-4d40-aa4a-209a3a2a8e00" />

-p tässä viittaa portteihin, 21 portin sijaintia / numeroa


f)	Tässä on foo.nmap tulokset 
 <img width="602" height="655" alt="image" src="https://github.com/user-attachments/assets/ba1cd643-8caa-4c34-b970-e74e40178875" />

Hyvänä puolena tässä on se, että tässä näkyy paljon enemmän tietoja, esim. milloin skannaus on tehty, targetin MAC Addressin jne. Tietokannassa näitä tietoja ei näkynyt, tietokannan hyvä puoli kuitenkin on se, että näihin tietoihin pääsee helposti käsiksi yhdellä komennolla. 
g)	Aloitin siitä, kuten tehtävässä x) näytettiin, eli etsin sen exploitin mitä haluan käyttää
 <img width="602" height="307" alt="image" src="https://github.com/user-attachments/assets/6d199794-dc98-487d-a237-8f0825b7ca54" />

Käytän exploittiä millä on rank: excellent.
 <img width="602" height="739" alt="image" src="https://github.com/user-attachments/assets/a1becbf8-f85e-44b4-aaa3-a79081ba27d3" />

Siinä oli näköjään asetettu joku defaultti payloadi
Nyt pitä asettaa ip osoite minne exploittia kohdennetaan, se selvisi siitä kun käytin show options komentoa, siinä näkyy mitkä asetukset ovat pakollisia.
 <img width="602" height="732" alt="image" src="https://github.com/user-attachments/assets/c239299e-d90c-4444-b9b7-fd9905658a89" />

Asetan rhostin 
 <img width="602" height="733" alt="image" src="https://github.com/user-attachments/assets/65b80f72-be63-4b6d-8036-90c28ce3bd47" />

Tästä syntyi ongelma, hostiin ei pääse ottaa yhteyttä.
 <img width="602" height="741" alt="image" src="https://github.com/user-attachments/assets/f0175e29-d0db-4f67-b795-fc7c41884f95" />

Huomasin että olin asettanut RHOSTIN väärin, tässä oikea
<img width="602" height="731" alt="image" src="https://github.com/user-attachments/assets/a2573e82-f6c7-4a1a-b8ea-01e0776ca961" />

Nyt sain sessioon yhteyden.
Tässä varmistin muutamalla komennolla että missä olen, mitkä oikeudet mulla on jua mitä tiedostoja minulla on käytettävissä.
 <img width="602" height="736" alt="image" src="https://github.com/user-attachments/assets/c8ab150a-4833-4b79-9938-5641ef7b2786" />


Sessio piti asettaa backgroundiksi että sen voi tallentaa meterpreteriin
<img width="602" height="427" alt="image" src="https://github.com/user-attachments/assets/d54c1940-046b-4901-b23e-c417d8dc3156" />
<img width="602" height="421" alt="image" src="https://github.com/user-attachments/assets/3abbfba7-1362-4c82-b466-cbcf1d1ac1ec" />


 

 

Sen jälkeen kun olin tallentanut sessiot ja mennyt meterpeteriin, en saanut enään avattua sessiota. Sessiot olivat poistuneet ja kun yritin yhdistää metasploittiin uudestaan, kyseinen errori tuli.
<img width="602" height="396" alt="image" src="https://github.com/user-attachments/assets/793225c9-16fc-43d7-b7b1-93793b771d0a" />
 
Tässä vaiheessa koitin uutta exploittia,
Yritin tunkeutua kohteeseen käyttämällä 6667 portilla olevaa palvelinta.
<img width="602" height="431" alt="image" src="https://github.com/user-attachments/assets/d74c3b1a-61b8-4eea-a1de-f8abf1081dc3" />

Kuitenkin päädyin samaan lopputulokseen, missä en pääsenyt yhdistämään metasploittiin.
<img width="602" height="380" alt="image" src="https://github.com/user-attachments/assets/a04c9d25-b2c1-4cf7-9e7c-59e80ee8d21d" />

Lähteet: 
https://www.offsec.com/metasploit-unleashed/using-databases/
https://hackers-arise.com/metasploit5-basics-part-4-connecting-and-using-the-postgresql-database-with-metasploit/
https://nmap.org/book/man-port-scanning-techniques.html



