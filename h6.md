# A)  
Viimeläksyissä tuli msfvenomi tutuksi ja tehtiin muutama payloadi viimeisessä harjoituksessa. En selostanut tässä enempää samaa asiaa, vaan menin suoraan tehtävänantoon.

Tässä mietin mitä kaikkea minun kannattaisi kokeilla, jotta wiresharkki pystyitsi havaitsemaan esim ladatut tiedostot

<img width="940" height="466" alt="image" src="https://github.com/user-attachments/assets/1dcd117f-4e7a-4172-bb22-e017c0c58390" />

Näitä download pyyntöjä en itse pystynyt havaitsemaan wiresharkissa, (johtuu siitä, että en ymmärrä wiresharkkia tarpeeksi)

Kuitenkin wiresharkkiin ilmestyi mielenkiintoinen protocolla, nimeltään BROWSER. Tämä poikkesi selvästi muista joten lähtin tutkimaan.

Kun avasin kyseisen liikennen, näkyi cleartekstinä että tämä on metasploitablen yhteys.

<img width="1081" height="273" alt="image" src="https://github.com/user-attachments/assets/aeeeaea2-e0db-4d0f-b04a-ac7348f58c2c" />

Tämä siis ei ole toivottu yhteys mitä halutaan seurata, tutkitaan lisää. 

Käynnistin wiresharkin uudestaan (tässä vaiheessa tajusin, että olin wiresharkilla kuunnellut väärää yhteyttä), käytin capture methodina "any", sain tuorreet capturet ja siitä selvisi yhteys nopeammin.

<img width="1618" height="69" alt="image" src="https://github.com/user-attachments/assets/2a0755bf-4937-4108-af5e-97b84c8a7162" />

Tämä on oikea, sillä 4343 porttia käytin payloadin asetuksissa, + mikään muu sovellus ei käytä 4343 porttia joten tämä oli melko itsestään selvä.

Kokeilin komentoa ls meterpreterissä, tämä avasi kasan uusia yhteyksiä wiresharkkiin.

<img width="1300" height="372" alt="image" src="https://github.com/user-attachments/assets/b8accff7-cbdc-47ba-b597-1ea0eab64a7f" />

Yhteyden tunnistautumista voisi vaikeuttaa sillä, että käyttäisi porttia mitä yleisesti muut TCP portilla pyörivät sovellukset käyttävät. 

VPN:n käyttäminen mahdollistaisi hyökkääjän ip:n piilottamista. 

---LISÄYS--- 22:38

Luin aiheesta hieman enemmän, yleinen tapa mitä hyökkääjät käyttävät ovat botnetit. Heillä on jo ennaltaan infektoituja koneita mistä he sitten ottavat yhteyttä kohdekoneesta, eikä varsinaisesti omalta konelta suoraan.

---END---

# B)

Aloitin siitä, että asensin sliverin.

<img width="672" height="275" alt="image" src="https://github.com/user-attachments/assets/35eb766a-7202-4cfb-a67f-04a9e0a2c215" />

Navigoin oikeeseen hakemistoon missä sliver oli asennettu.

<img width="265" height="46" alt="image" src="https://github.com/user-attachments/assets/7e1cf694-b25f-48cb-add2-1958b56e9fe2" />

Käynnistin sliverin

<img width="515" height="236" alt="image" src="https://github.com/user-attachments/assets/5a496f94-a949-4beb-bba9-436c5733f79a" />

Aluksi yritin muutamaa tapaa generoida payloadi.

<img width="617" height="75" alt="image" src="https://github.com/user-attachments/assets/9bc5d860-8d65-4b70-bd07-9289a34cc8a2" />

Tämä tapa ei onnistunut, joten päätin lukea dokkeja vähäsen. 

Dokeissa annetaan esimerkki, missä 

'sliver > generate --http example.com --os mac'

Tästä päättelin, että pitääkö -http olla ip osoite, sen sijaan että käytän pelkkää localhostia. En myöskään specifoi lporttia, koska se tuotti ongelmia. Sliverin käyttää defaulttina porttia 80

Kuitenkin, generointi epäonnistui

<img width="544" height="135" alt="image" src="https://github.com/user-attachments/assets/0060ebc1-31cd-4cc3-b4fe-2b9f26a813f8" />

Kun katsoin error viestiä tarkemmin, tajusin, että sliverillä ei ole oikeuksia tehdä tiedostoa. Joten sulkesin sliverin ja runnasin ohjelman sudo sliver komennolla

Tämän jälkeen implantin generointikin onnistui. Käynnistin malwaren ja silveriin syntyi sessio.

<img width="459" height="120" alt="image" src="https://github.com/user-attachments/assets/6b00915d-3e77-4135-9910-038756bf87cc" />

<img width="948" height="44" alt="image" src="https://github.com/user-attachments/assets/54a7781b-3e17-48eb-a88a-16c5784e068c" />



# C)

Tässä on havaittu yhteys. Koska Sliver käyttää 80 porttia defaulttina, niin voin olettaa, että tämä on yhteys mitä halutaan tarkkailla. Portti 80 on standardi HTTP liikennelle suunattu portti, joten se on piiloutunut liikenteeseen hyvin. Kuitenkin, hyökkääjä voi valita minkä tahansa portin, joten oikeassa simulaatiossa en voisi tietää porttia mitä hyökkääjä käyttää.

<img width="940" height="41" alt="image" src="https://github.com/user-attachments/assets/01d7dff9-4bb2-4188-8fc5-3d5db5377619" />

Mielenkiintoinen havainto oli se, että verrattuna normaaliin HTTP requesteihin, sliver teki erikoisija pyyntöjä, kuten email.js, bootstrap.min.js, jscript/. Nämä poikkeavat normaalista liikennestä. Jos tämä olisi oikea simulaatio lähtisin tutkimaan näitä. Toki en tiedä pystyykö näitä pyyntötyyppejä vaihtamaan, joku taitavampi sliverin käyttäjä pystyisi ohjelman tekemän sellaiseksi, että nämä ilmiselvät pyynnöt olisivatkin jotain eri pyyntöjä, mitkä maskeerautuvat paremmin oikeeseen liikenteeseen.

(Normaali HTTP pavelimen pyyntö)

<img width="940" height="201" alt="image" src="https://github.com/user-attachments/assets/9875c065-55a8-4d9a-aa31-529026e09501" />

(Sliverin HTTP pyyntö)

<img width="940" height="228" alt="image" src="https://github.com/user-attachments/assets/efce4787-de0b-460a-a35b-0c2ab16713df" />

# D)

En ollu ihan varma mitä tällä haettiin, joten itse ajattelin että tämä yhteyden muokkaaminen voisi tarkoittaa esim. reconnect intervalin vaihtamista tai socks5 proxyn käyttämistä.

Info komennolla sain tietää mikä on nykyinen intervaali

<img width="677" height="364" alt="image" src="https://github.com/user-attachments/assets/b73ad2d6-0f7d-4915-a6a6-3034c9a97e1c" />

Intervaalin vaihtaminen oli helppoa, aluksi etsin miten se tehdään, kokeilin reconfig --help

Siitä tuli kasa komentoja

<img width="748" height="382" alt="image" src="https://github.com/user-attachments/assets/e1223dd0-313f-4e7a-bc2a-a305d1133ced" />

Todistan että muutokset tulivat voimaan info komennolla

<img width="676" height="328" alt="image" src="https://github.com/user-attachments/assets/d5fb3b0a-62d5-40be-968c-3d355ea18bcd" />

Seuraavaksi kokeilen socks5 proxyä

<img width="577" height="686" alt="image" src="https://github.com/user-attachments/assets/74db00f8-9d31-438c-b692-a55fb12d8e13" />

Kuitenkaan info tasolla ei mitään tapahtunut, katsotaan wiresharkkia.

En huomannut tääläkään mitään muutosta, päitsi uusi ::1 yhteys mitä en ole aikasemmin huomannut.

<img width="861" height="384" alt="image" src="https://github.com/user-attachments/assets/864d736e-f084-4694-b965-1930972e2017" />

En edes ihan täysin ymmärrä mitä socks5 tekee, perehdyn tähän myöhemmin kun teen lisätehtävät. Voisin kuitenkin kuvitella että tämä on se socks5 yhteys.

# F)

Tässä kasa komentoja mitä sliverillä voi suorittaa.

<img width="963" height="731" alt="image" src="https://github.com/user-attachments/assets/1142d6ab-148a-40fe-abe1-f8d373bcb892" />

Päätin ottaa näistä 3, Download, screenshot ja procdump

1. Download

Käytin komentoa download tero.zip 

<img width="762" height="32" alt="image" src="https://github.com/user-attachments/assets/2c12fbad-6ebb-4d1e-b18f-44fc90408050" />

2. screenshot

latasin screenshotin sliverin loot hakemistoon 

<img width="857" height="62" alt="image" src="https://github.com/user-attachments/assets/f1e3f788-e4fb-4580-8303-1036c9985859" />

3. procdump

Eli kaikki tiedot mitkä olivat wiresharkin muistissa dumpataan sliveriin

procdump -n wireshark

<img width="832" height="411" alt="image" src="https://github.com/user-attachments/assets/160b9043-1d5f-4ec1-b678-9e107b80de94" />

# G) 

Haittaohjelman generointi oli helppoa, sillä osasin komennot jo.

<img width="922" height="153" alt="image" src="https://github.com/user-attachments/assets/dbdc2571-edac-4376-848e-6d9da2f5fcfa" />

Halusin tehdä myös windows koneelle haittaohjelman ja oikeesti ottaa yhteyttä minun kali linuxista VMstä natiivi os windowsiin. 

Lataamisessa oli pieniä ongelmia, koitin aluksi kaikkia julkisia fileshare alustoja mutta ne ei näköjää halua levittää viruksia >.< 

Kysyin tekoälyltä neuvoja ja se neuvosi minut hostaa impacketing smbserverin. 

<img width="235" height="269" alt="image" src="https://github.com/user-attachments/assets/39045684-a837-49d0-a9f5-8ca2bbe14007" />

Sitten latasin tiedoston käyttäen CMDtä. Piti myös laitta windows defenderi pois päältä sillä se tunnisti ohjelman haitalliseksi.

<img width="564" height="56" alt="image" src="https://github.com/user-attachments/assets/8485d741-5c65-4c62-9453-63c2ee220339" />

Wiresharkilla löysin kali linuxin ottamassa suoraan yhteyttä minun host OS:ssään

<img width="812" height="141" alt="image" src="https://github.com/user-attachments/assets/26c92f7c-1172-4f35-a348-e5bfc687c430" />

Lähteet:

https://terokarvinen.com/tunkeutumistestaus/#laksyt

https://www.huntandhackett.com/blog/hunting-for-a-sliver

https://wiki.wireshark.org/DisplayFilters

https://dominicbreuker.com/post/learning_sliver_c2_08_implant_basics/

